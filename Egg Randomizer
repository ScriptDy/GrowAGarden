-- Kuni-style Pet Hatch GUI for "Grow a Garden" (LocalScript)
-- Put this LocalScript in StarterPlayerScripts (client-side)
-- Features: Dark GUI, white buttons, Nearby Egg ESP (billboard + highlight),
-- Randomize with countdown, Auto Randomize, Toggle ESP, Minimize

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- ======= Config =======
local SCAN_RADIUS = 60 -- studs to search for eggs
local AUTO_INTERVAL = 6 -- seconds between auto-randomize cycles
local BILLBOARD_MAXDIST = 500

-- Example pet/egg map (edit to match your game's exact Model names)
local petTable = {
    ["Common Egg"] = { "Dog", "Bunny", "Golden Lab" },
    ["Uncommon Egg"] = { "Chicken", "Black Bunny", "Cat", "Deer" },
    ["Rare Egg"] = { "Pig", "Monkey", "Rooster", "Orange Tabby", "Spotted Deer" },
    ["Legendary Egg"] = { "Cow", "Polar Bear", "Sea Otter", "Turtle", "Silver Monkey" },
    ["Mythical Egg"] = { "Grey Mouse", "Brown Mouse", "Squirrel", "Red Fox", "Red Giant Ant" },
    ["Gourmet Egg"] = { "Bagel Bunny", "Pancake Mole", "Sushi Bear", "Spaghetti Sloth", "French Fry Ferret" },
    -- add other egg names used by your game here
}

-- ======= State =======
local espEnabled = true
local truePetMap = {}      -- eggModel -> chosen pet name
local autoRunning = false
local autoCoroutine -- store coroutine so we can stop it

-- ======= Utility functions =======
local function safeParent(instance, parent)
    instance.Parent = parent
    return instance
end

local function createBillboardFor(part, text, ready)
    -- remove existing
    local existing = part:FindFirstChild("PetBillboard", true)
    if existing then existing:Destroy() end

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "PetBillboard"
    billboard.Size = UDim2.new(0, 270, 0, 50)
    billboard.AlwaysOnTop = true
    billboard.MaxDistance = BILLBOARD_MAXDIST
    billboard.StudsOffset = Vector3.new(0, 4.5, 0)
    billboard.Parent = part

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextScaled = true
    label.Font = Enum.Font.FredokaOne
    label.Text = text
    if not ready then
        label.Text = text .. " (Not Ready)"
        label.TextColor3 = Color3.fromRGB(160,160,160)
        label.TextStrokeTransparency = 0.5
    else
        label.TextColor3 = Color3.fromRGB(255,255,255)
        label.TextStrokeTransparency = 0
    end
    label.Parent = billboard

    -- small "glitch" effect (blink twice)
    coroutine.wrap(function()
        local original = label.TextColor3
        for i = 1,2 do
            label.TextColor3 = Color3.new(0,1,0)
            task.wait(0.07)
            label.TextColor3 = original
            task.wait(0.07)
        end
    end)()
end

local function createHighlightOn(model)
    -- remove existing
    local existing = model:FindFirstChild("ESPHighlight")
    if existing then existing:Destroy() end
    -- create new highlight
    local highlight = Instance.new("Highlight")
    highlight.Name = "ESPHighlight"
    highlight.Adornee = model
    highlight.FillColor = Color3.fromRGB(255, 200, 0)
    highlight.OutlineColor = Color3.fromRGB(255,255,255)
    highlight.FillTransparency = 0.7
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Parent = model
end

local function removeESPFrom(model)
    local b = model:FindFirstChild("PetBillboard", true)
    if b then b:Destroy() end
    local h = model:FindFirstChild("ESPHighlight")
    if h then h:Destroy() end
end

local function isEggModel(m)
    return m:IsA("Model") and petTable[m.Name] ~= nil
end

local function findBasePart(model)
    for _, v in pairs(model:GetDescendants()) do
        if v:IsA("BasePart") then
            return v
        end
    end
    return nil
end

local function eggReadyCheck(eggModel)
    -- heuristic: if a "HatchTime" NumberValue exists and >0 -> not ready
    local hatchTime = eggModel:FindFirstChild("HatchTime")
    if hatchTime and hatchTime:IsA("NumberValue") and hatchTime.Value > 0 then
        return false
    end
    -- or if there's a BoolValue ReadyToHatch false
    local readyFlag = eggModel:FindFirstChild("ReadyToHatch")
    if readyFlag and readyFlag:IsA("BoolValue") and not readyFlag.Value then
        return false
    end
    return true
end

-- ======= Scanning / ESP =======
local function getNearbyEggs(radius)
    local result = {}
    local char = player.Character or player.CharacterAdded:Wait()
    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then return result end

    for _, obj in ipairs(Workspace:GetDescendants()) do
        if isEggModel(obj) then
            local success, cframe = pcall(function() return obj:GetModelCFrame() end)
            if success and cframe then
                local pos = cframe.Position
                if (pos - root.Position).Magnitude <= (radius or SCAN_RADIUS) then
                    -- ensure an entry in truePetMap
                    if not truePetMap[obj] then
                        local pets = petTable[obj.Name]
                        truePetMap[obj] = pets[math.random(1, #pets)]
                    end
                    table.insert(result, obj)
                end
            end
        end
    end
    return result
end

local function applyEggESP(eggModel, petName)
    if not espEnabled then return end
    local basePart = findBasePart(eggModel)
    if not basePart then return end
    local ready = eggReadyCheck(eggModel)
    createBillboardFor(basePart, eggModel.Name .. " | " .. petName, ready)
    createHighlightOn(eggModel)
end

local function randomizeNearbyEggs()
    local eggs = getNearbyEggs(SCAN_RADIUS)
    for _, egg in ipairs(eggs) do
        local pets = petTable[egg.Name]
        if pets and #pets > 0 then
            local chosen = pets[math.random(1, #pets)]
            truePetMap[egg] = chosen
            applyEggESP(egg, chosen)
        end
    end
end

-- periodically keep ESP applied to nearby eggs (in case new eggs spawn)
spawn(function()
    while true do
        if espEnabled then
            for _, egg in ipairs(getNearbyEggs(SCAN_RADIUS)) do
                local chosen = truePetMap[egg] or petTable[egg.Name] and petTable[egg.Name][1] or "Unknown"
                applyEggESP(egg, chosen)
            end
        end
        task.wait(2)
    end
end)

-- Clean up truePetMap when eggs destroyed
Workspace.DescendantRemoving:Connect(function(desc)
    if isEggModel(desc) then
        truePetMap[desc] = nil
    end
end)

-- ======= GUI =======
-- create ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "KuniPetHatch"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 240, 0, 310)
frame.Position = UDim2.new(0, 20, 0, 100)
frame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
frame.BorderSizePixel = 0
frame.Parent = gui
local uiCorner = Instance.new("UICorner", frame)
uiCorner.CornerRadius = UDim.new(0, 12)
local stroke = Instance.new("UIStroke", frame)
stroke.Color = Color3.fromRGB(90, 90, 90)
stroke.Thickness = 1
stroke.Transparency = 0.3

local function createButton(text, y)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 30)
    btn.Position = UDim2.new(0, 10, 0, y)
    btn.BackgroundColor3 = Color3.fromRGB(235, 235, 235)
    btn.Text = text
    btn.Font = Enum.Font.FredokaOne
    btn.TextSize = 14
    btn.TextColor3 = Color3.fromRGB(25, 25, 25)
    btn.AutoButtonColor = false
    local corner = Instance.new("UICorner", btn)
    corner.CornerRadius = UDim.new(0, 6)
    local btnStroke = Instance.new("UIStroke", btn)
    btnStroke.Color = Color3.fromRGB(200,200,200)
    btnStroke.Thickness = 1
    btn.Parent = frame

    btn.MouseEnter:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.18), {BackgroundColor3 = Color3.fromRGB(220,220,220)}):Play()
        btnStroke.Thickness = 1.5
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.18), {BackgroundColor3 = Color3.fromRGB(235,235,235)}):Play()
        btnStroke.Thickness = 1
    end)
    return btn
end

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 28)
title.Position = UDim2.new(0, 0, 0, 4)
title.BackgroundTransparency = 1
title.Text = "Yawi Hub X"
title.Font = Enum.Font.FredokaOne
title.TextSize = 17
title.TextColor3 = Color3.fromRGB(255, 225, 130)
title.TextStrokeTransparency = 0.7

-- drag support
local dragButton = Instance.new("TextButton", title)
dragButton.Size = UDim2.new(1,0,1,0)
dragButton.BackgroundTransparency = 1
dragButton.Text = ""
dragButton.AutoButtonColor = false

local dragging = false
local dragOffset = Vector2.new(0,0)
dragButton.MouseButton1Down:Connect(function()
    dragging = true
    dragOffset = Vector2.new(mouse.X - frame.AbsolutePosition.X, mouse.Y - frame.AbsolutePosition.Y)
end)
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)
RunService.RenderStepped:Connect(function()
    if dragging then
        frame.Position = UDim2.new(0, mouse.X - dragOffset.X, 0, mouse.Y - dragOffset.Y)
    end
end)

-- Buttons
local randomBtn = createButton("Randomize Pets", 36)
randomBtn.MouseButton1Click:Connect(function()
    randomBtn.Text = "Randomizing in: 3"
    for i = 2, 1, -1 do
        task.wait(1)
        randomBtn.Text = "Randomizing in: " .. i
    end
    randomizeNearbyEggs()
    randomBtn.Text = "Randomize Pets"
end)

local toggleBtn = createButton("Show ESP (ON)", 72)
toggleBtn.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    toggleBtn.Text = espEnabled and "Show ESP (ON)" or "Show ESP (OFF)"
    if not espEnabled then
        -- remove current ESP for nearby eggs
        for _, egg in ipairs(getNearbyEggs(SCAN_RADIUS)) do
            removeESPFrom(egg)
        end
    else
        -- reapply
        for _, egg in ipairs(getNearbyEggs(SCAN_RADIUS)) do
            local chosen = truePetMap[egg] or petTable[egg.Name] and petTable[egg.Name][1] or "Unknown"
            applyEggESP(egg, chosen)
        end
    end
end)

local autoBtn = createButton("Auto Randomize (OFF)", 108)
autoBtn.MouseButton1Click:Connect(function()
    autoRunning = not autoRunning
    autoBtn.Text = autoRunning and "Auto Randomize (ON)" or "Auto Randomize (OFF)"

    if autoRunning then
        -- start coroutine
        autoCoroutine = coroutine.create(function()
            while autoRunning do
                randomBtn.Text = "Randomizing in: 3"
                for i = 2, 1, -1 do
                    task.wait(1)
                    randomBtn.Text = "Randomizing in: " .. i
                end
                randomizeNearbyEggs()
                randomBtn.Text = "Randomize Pets"
                local waitTime = AUTO_INTERVAL
                while waitTime > 0 and autoRunning do
                    task.wait(1)
                    waitTime = waitTime - 1
                end
            end
        end)
        coroutine.resume(autoCoroutine)
    else
        -- let coroutine exit naturally
    end
end)

local openAgeBtn = createButton("Open Pet Age Changer", 144)
openAgeBtn.MouseButton1Click:Connect(function()
    -- Placeholder: if you want to load an external utility, put your safe URL here.
    -- Example (commented): loadstring(game:HttpGet("https://your-safe-url-here.lua"))()
    openAgeBtn.Text = "Not linked"
    task.delay(1.2, function() openAgeBtn.Text = "Open Pet Age Changer" end)
end)

local mutationBtn = createButton("Open Pet Mutation Finder", 180)
mutationBtn.MouseButton1Click:Connect(function()
    mutationBtn.Text = "Not linked"
    task.delay(1.2, function() mutationBtn.Text = "Open Pet Mutation Finder" end)
end)

local duplicateBtn = createButton("Open Pet Cloner", 216)
duplicateBtn.MouseButton1Click:Connect(function()
    duplicateBtn.Text = "Not linked"
    task.delay(1.2, function() duplicateBtn.Text = "Open Pet Cloner" end)
end)

local credit = Instance.new("TextLabel", frame)
credit.Size = UDim2.new(1, 0, 0, 18)
credit.Position = UDim2.new(0, 0, 0, 260)
credit.BackgroundTransparency = 1
credit.Text = "Tiktok: @yawiyawiyawiz1"
credit.Font = Enum.Font.FredokaOne
credit.TextSize = 12
credit.TextColor3 = Color3.fromRGB(180, 180, 180)

-- Minimize
local miniBtn = Instance.new("TextButton")
miniBtn.Size = UDim2.new(0, 24, 0, 24)
miniBtn.Position = UDim2.new(1, -28, 0, 4)
miniBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
miniBtn.Text = "-"
miniBtn.Font = Enum.Font.Fred
